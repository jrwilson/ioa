<html lang="en">
<head>
<title>Copying - ioa++</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="ioa++">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="prev" href="Function-Index.html#Function-Index" title="Function Index">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
This manual is for ioa++, version 0.01.

Copyright (C) 2011 Justin R. Wilson.

     Licensed under the Apache License, Version 2.0 (the "License");
     you may not use this file except in compliance with the License.
     You may obtain a copy of the License at
     http://www.apache.org/licenses/LICENSE-2.0

     Unless required by applicable law or agreed to in writing,
     software distributed under the License is distributed on an "AS
     IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
     express or implied.  See the License for the specific language
     governing permissions and limitations under the License.
   -->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="Copying"></a>
<p>
Previous:&nbsp;<a rel="previous" accesskey="p" href="Function-Index.html#Function-Index">Function Index</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="index.html#Top">Top</a>
<hr>
</div>

<h2 class="unnumbered">Copying</h2>

<blockquote>
                                 Apache License
                           Version 2.0, January 2004
                        http://www.apache.org/licenses/

   <p>TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION

   <p>1. Definitions.

   <p>"License" shall mean the terms and conditions for use, reproduction,
      and distribution as defined by Sections 1 through 9 of this document.

   <p>"Licensor" shall mean the copyright owner or entity authorized by
      the copyright owner that is granting the License.

   <p>"Legal Entity" shall mean the union of the acting entity and all
      other entities that control, are controlled by, or are under common
      control with that entity. For the purposes of this definition,
      "control" means (i) the power, direct or indirect, to cause the
      direction or management of such entity, whether by contract or
      otherwise, or (ii) ownership of fifty percent (50%) or more of the
      outstanding shares, or (iii) beneficial ownership of such entity.

   <p>"You" (or "Your") shall mean an individual or Legal Entity
      exercising permissions granted by this License.

   <p>"Source" form shall mean the preferred form for making modifications,
      including but not limited to software source code, documentation
      source, and configuration files.

   <p>"Object" form shall mean any form resulting from mechanical
      transformation or translation of a Source form, including but
      not limited to compiled object code, generated documentation,
      and conversions to other media types.

   <p>"Work" shall mean the work of authorship, whether in Source or
      Object form, made available under the License, as indicated by a
      copyright notice that is included in or attached to the work
      (an example is provided in the Appendix below).

   <p>"Derivative Works" shall mean any work, whether in Source or Object
      form, that is based on (or derived from) the Work and for which the
      editorial revisions, annotations, elaborations, or other modifications
      represent, as a whole, an original work of authorship. For the purposes
      of this License, Derivative Works shall not include works that remain
      separable from, or merely link (or bind by name) to the interfaces of,
      the Work and Derivative Works thereof.

   <p>"Contribution" shall mean any work of authorship, including
      the original version of the Work and any modifications or additions
      to that Work or Derivative Works thereof, that is intentionally
      submitted to Licensor for inclusion in the Work by the copyright owner
      or by an individual or Legal Entity authorized to submit on behalf of
      the copyright owner. For the purposes of this definition, "submitted"
      means any form of electronic, verbal, or written communication sent
      to the Licensor or its representatives, including but not limited to
      communication on electronic mailing lists, source code control systems,
      and issue tracking systems that are managed by, or on behalf of, the
      Licensor for the purpose of discussing and improving the Work, but
      excluding communication that is conspicuously marked or otherwise
      designated in writing by the copyright owner as "Not a Contribution."

   <p>"Contributor" shall mean Licensor and any individual or Legal Entity
      on behalf of whom a Contribution has been received by Licensor and
      subsequently incorporated within the Work.

   <p>2. Grant of Copyright License. Subject to the terms and conditions of
      this License, each Contributor hereby grants to You a perpetual,
      worldwide, non-exclusive, no-charge, royalty-free, irrevocable
      copyright license to reproduce, prepare Derivative Works of,
      publicly display, publicly perform, sublicense, and distribute the
      Work and such Derivative Works in Source or Object form.

   <p>3. Grant of Patent License. Subject to the terms and conditions of
      this License, each Contributor hereby grants to You a perpetual,
      worldwide, non-exclusive, no-charge, royalty-free, irrevocable
      (except as stated in this section) patent license to make, have made,
      use, offer to sell, sell, import, and otherwise transfer the Work,
      where such license applies only to those patent claims licensable
      by such Contributor that are necessarily infringed by their
      Contribution(s) alone or by combination of their Contribution(s)
      with the Work to which such Contribution(s) was submitted. If You
      institute patent litigation against any entity (including a
      cross-claim or counterclaim in a lawsuit) alleging that the Work
      or a Contribution incorporated within the Work constitutes direct
      or contributory patent infringement, then any patent licenses
      granted to You under this License for that Work shall terminate
      as of the date such litigation is filed.

   <p>4. Redistribution. You may reproduce and distribute copies of the
      Work or Derivative Works thereof in any medium, with or without
      modifications, and in Source or Object form, provided that You
      meet the following conditions:

   <p>(a) You must give any other recipients of the Work or
          Derivative Works a copy of this License; and

   <p>(b) You must cause any modified files to carry prominent notices
          stating that You changed the files; and

   <p>(c) You must retain, in the Source form of any Derivative Works
          that You distribute, all copyright, patent, trademark, and
          attribution notices from the Source form of the Work,
          excluding those notices that do not pertain to any part of
          the Derivative Works; and

   <p>(d) If the Work includes a "NOTICE" text file as part of its
          distribution, then any Derivative Works that You distribute must
          include a readable copy of the attribution notices contained
          within such NOTICE file, excluding those notices that do not
          pertain to any part of the Derivative Works, in at least one
          of the following places: within a NOTICE text file distributed
          as part of the Derivative Works; within the Source form or
          documentation, if provided along with the Derivative Works; or,
          within a display generated by the Derivative Works, if and
          wherever such third-party notices normally appear. The contents
          of the NOTICE file are for informational purposes only and
          do not modify the License. You may add Your own attribution
          notices within Derivative Works that You distribute, alongside
          or as an addendum to the NOTICE text from the Work, provided
          that such additional attribution notices cannot be construed
          as modifying the License.

   <p>You may add Your own copyright statement to Your modifications and
      may provide additional or different license terms and conditions
      for use, reproduction, or distribution of Your modifications, or
      for any such Derivative Works as a whole, provided Your use,
      reproduction, and distribution of the Work otherwise complies with
      the conditions stated in this License.

   <p>5. Submission of Contributions. Unless You explicitly state otherwise,
      any Contribution intentionally submitted for inclusion in the Work
      by You to the Licensor shall be under the terms and conditions of
      this License, without any additional terms or conditions. 
      Notwithstanding the above, nothing herein shall supersede or modify
      the terms of any separate license agreement you may have executed
      with Licensor regarding such Contributions.

   <p>6. Trademarks. This License does not grant permission to use the trade
      names, trademarks, service marks, or product names of the Licensor,
      except as required for reasonable and customary use in describing the
      origin of the Work and reproducing the content of the NOTICE file.

   <p>7. Disclaimer of Warranty. Unless required by applicable law or
      agreed to in writing, Licensor provides the Work (and each
      Contributor provides its Contributions) on an "AS IS" BASIS,
      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
      implied, including, without limitation, any warranties or conditions
      of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
      PARTICULAR PURPOSE. You are solely responsible for determining the
      appropriateness of using or redistributing the Work and assume any
      risks associated with Your exercise of permissions under this License.

   <p>8. Limitation of Liability. In no event and under no legal theory,
      whether in tort (including negligence), contract, or otherwise,
      unless required by applicable law (such as deliberate and grossly
      negligent acts) or agreed to in writing, shall any Contributor be
      liable to You for damages, including any direct, indirect, special,
      incidental, or consequential damages of any character arising as a
      result of this License or out of the use or inability to use the
      Work (including but not limited to damages for loss of goodwill,
      work stoppage, computer failure or malfunction, or any and all
      other commercial damages or losses), even if such Contributor
      has been advised of the possibility of such damages.

   <p>9. Accepting Warranty or Additional Liability. While redistributing
      the Work or Derivative Works thereof, You may choose to offer,
      and charge a fee for, acceptance of support, warranty, indemnity,
      or other liability obligations and/or rights consistent with this
      License. However, in accepting such obligations, You may act only
      on Your own behalf and on Your sole responsibility, not on behalf
      of any other Contributor, and only if You agree to indemnify,
      defend, and hold each Contributor harmless for any liability
      incurred by, or claims asserted against, such Contributor by reason
      of your accepting any such warranty or additional liability.

   <p>END OF TERMS AND CONDITIONS

   <p>APPENDIX: How to apply the Apache License to your work.

   <p>To apply the Apache License to your work, attach the following
      boilerplate notice, with the fields enclosed by brackets "[]"
      replaced with your own identifying information. (Don't include
      the brackets!)  The text should be enclosed in the appropriate
      comment syntax for the file format. We also recommend that a
      file or class name and description of purpose be included on the
      same "printed page" as the copyright notice for easier
      identification within third-party archives.

   <p>Copyright [yyyy] [name of copyright owner]

   <p>Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License. 
   You may obtain a copy of the License at

   <p>http://www.apache.org/licenses/LICENSE-2.0

   <p>Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. 
   See the License for the specific language governing permissions and
   limitations under the License. 
</blockquote>

<!-- @chapter Using the Formalism -->
<!-- @chapter Gotchas -->
<!-- @chapter Tips and Tricks -->
<!-- @section The Problem with Threads -->
<!-- The thread model dominates modern computing. -->
<!-- A @dfn{thread} consists of a sequence of instructions, state, and an instruction pointer indicating the location of the current instruction. -->
<!-- Conventional processors are a direct implementation of the thread model, mainstream compilers are designed to produce code for these processors, and modern operating systems are designed to execute programs on these processors. -->
<!-- Naturally, the application developed for these systems are also based on the thread model. -->
<!-- The dominance of the thread model makes it a practical choice for concurrency. -->
<!-- A physical processor can be multiplexed to execute multiple threads by repeatedly switching from one thread to another. -->
<!-- Multiple processors allow concurrent threads to execute simultaneously. -->
<!-- Concurrent threads communicate by sharing state and using synchronization primitives to control access to the state. -->
<!-- A section of code that updates shared state is called a @dfn{critical section}. -->
<!-- There are two main issues with using threads as a basis for concurrency. -->
<!-- The first is that reasoning about the correctness of a threaded program is notoriously difficult because one must consider all possible interleavings of critical sections. -->
<!-- System developers know that developing and debugging shared-state, lock-based programs is difficult. -->
<!-- Threads are also not composable. -->
<!-- One cannot combine the code for two threads into a single thread and reason about the behavior of the composition as the interactions of the two original threads. -->
<!-- The second issue is a diversity of threading techniques, resulting in systems that cannot easily be integrated. -->
<!-- Consider an application based on a reactive event loop that wishes to use a library that performs blocking I/O. -->
<!-- If the goal is to be responsive, the programmer must wrap all calls to the library as events and pass them to another thread to perform the blocking I/O. -->
<!-- The overhead of integration is often not negligible and tends to be a source of concurrency bugs. -->
<!-- @c In addition to the problems just mentioned, the clock frequencies of processors have reached a ceiling and processor manufacturers are looking to multi-core to deliver increased performance. -->
<!-- @c Gains in performance will only be realized through better data structures and algorithms, optimization, hardware acceleration, or concurrent computation. -->
<!-- @section The Search for Better Models -->
<!-- To ease the difficulties of developing systems with threads, practitioners and researchers have explored a number of options including new programming languages, language extensions, and libraries/frameworks/middleware/design patterns. -->
<!-- New programming languages and their run-time systems tend to not be adopted unless they resemble the language used to implement the operating system. -->
<!-- Consequently, C, C++, Java, and the like will dominate system programming languages for the foreseeable future. -->
<!-- Language extensions by their very definition are non-standard and therefore cannot be used to develop portable software. -->
<!-- Furthermore, concurrency is rather large and difficult piece to bolt on to an existing programming language. -->
<!-- Libraries, frameworks, middleware, and design patterns have been successful because they can take advantage of existing compilers and operating systems. -->
<!-- However, they tend to focus on domain-specific problems and lack generality in that sense. -->
<!-- I agree with Chris Gill's argument that the reason we have not found a better solution for concurrency is because we've been looking the wrong places. -->
<!-- Specifically, we've only considered domain-specific solutions that are all variations of the thread model. -->
<!-- I argue that a better place to look is the formal methods community. -->
<!-- The formal methods community has proposed a number of different models for concurrency, e.g., Petri nets, UNITY, I/O automata, all for the purpose of making reasoning about concurrency easier. -->
<!-- It stands to reason that a model that makes formal reasoning about concurrency easier will also make informal reasoning about concurrency easier. -->
<!-- What is lacking are implementations of these models that permit an honest evaluation. -->
<!-- Ideally, one would build a processor, programming language, operating system, and applications all based on Petri nets to evaluate the usefulness of Petri nets as a model of concurrency. -->
<!-- Cost and effort prohibit such a bottom-up approach. -->
<!-- Conversely, starting at the top and working down is a much better approach as many models can be tried with a smaller investment. -->
<!-- A model that succeeds can gradually sink from the application layer to the operating system layer. -->
<!-- Further subsuming is only necessary if a new programming language is need to make programming in the new model more efficient (for the machine or the programmer) or a new processor architecture based on the model provides significant advantages over existing processor architectures. -->
<!-- @section Scope -->
<!-- In pursuit of production grade implementations of different models of concurrency, @acronym{UEIOA} is an application level implementation of the I/O automata model. -->
<!-- @chapter Tutorial -->
<!-- @chapter Cookbook -->
<!-- @chapter Reference -->
<!-- @chapter Examples -->
<!-- @chapter FAQ -->
<!-- * Action Wrappers -->
<!-- Sensing when an action changes binding status is useful. -->
<!-- Consider a pair of automata, A and B, that are bound. -->
<!-- If either one of them dies, the other should die. -->
<!-- The automata can detect the death of the other by detecting when their respective actions are unbound. -->
<!-- The Observer Pattern to the rescue again. -->
<!-- We can make all input and output wrappers be observable so the automaton can know when something changes status. -->
<!-- The thread model is at the heart of modern computing as indicated by modern processors, programming languages, and operating systems. -->
<!-- A thread consists of 1) a sequence of instructions, 2) an instruction pointer indicating the current instruction, and 3) state that is manipulated by the instructions. -->
<!-- The current instruction and thread state including the instruction pointer determines the subsequent instruction pointer with the default being to advance to the next instruction. -->
<!-- All major processors are a direct realization of the thread model. -->
<!-- All major programming languages are based on the structured sequential programming paradigm which is defined using the thread abstraction. -->
<!-- All major operating systems are written using sequential languages and multiplex processors among different threads by periodically interrupting the current thread,  saving its instruction pointer and other processor state, and then loading and starting another thread. -->
<!-- Most modern applications are thread-based due to the strong agreement between the processor, programming language, and operating system. -->
<!-- # File System -->
<!-- The file system is a critical part of traditional operating systems. -->
<!-- If we use communication sequential processes, then we can model the virtual file system (or kernel) as a process that rendezvous with user processes at open, read, write, etc. -->
<!-- In an I/O Automata-based operating system, the file system is just another coordination mechanism. -->
<!-- From the bottom up, we can model physical disks as (physical) automata. -->
<!-- On top of the disks are file system drivers, e.g., ext, FAT, xfs, that are also automata. -->
<!-- On top of the disk drivers is the virtual file system automaton. -->
<!-- The virtual file system automaton creates file and directory automata with which users can interact. -->
<!-- Using I/O Automata to build a virtual file system has the potential to simplify certain features such as change notification and database triggers. -->
<!-- Inputs -->
<!-- read -->
<!-- write -->
<!-- Ouputs -->
<!-- read_complete -->
<!-- write_complete -->
<!-- (We are asynchronous.  Consequently, we could take advantage of ASIO if it is available.  The complete calls allow us to have good back pressure (or flow control).) -->
<!-- Closing can be accomplished with an input or upon the first action unbind. -->
<!-- * Memory allocation -->
<!-- The scheduler knows what automaton is running at any given time. -->
<!-- Thus, we can associated allocated memory with an automaton and free it when the automaton is destroyed. -->
<!-- * Helpers -->
<!-- System calls cannot be made while in the constructor of an automaton because the "this" pointer is not known to the scheduler and can't be used for certian sanity checks. -->
<!-- So, the helpers have methods, create and bind respectively, that that get the helpers started. -->
<!-- A starting point is to move all of the parameters required at construction to the appropriate start-up method. -->
<!-- We desire (and have) the ability to create helpers dynamically, either directly (calling "new helper") or indirectly (calling "new object" where object contains one or more helpers). -->
<!-- This gives us the power to create dynamic constellations of automata. -->
<!-- However, they must be stopped before they are destroyed. -->
<!-- To illustrate, consider the following sequence -->
<!-- new automaton_helper -->
<!-- create -> -->
<!-- created <-              automaton -->
<!-- |                        | -->
<!-- delete automaton_helper       | -->
<!-- | -->
<!-- delete automaton -->
<!-- <-destroyed  [The system will call a non-existent callback.] -->
<!-- Instead of calling delete, the sequence should contain a destroy/unbind call. -->
<!-- The handler in the helper can then call delete to clean up. -->
<!-- The new sequence looks like. -->
<!-- new automaton_helper -->
<!-- create -> -->
<!-- created <-              automaton -->
<!-- |                        | -->
<!-- automaton_helper->destroy ()  | -->
<!-- |                        | -->
<!-- |                 delete automaton -->
<!-- <-destroyed  [The helper will call "delete this" to clean the helper.] -->
<!-- If the helper always calls delete, then we cannot have statically allocated helpers. -->
<!-- This seems acceptable to me at this time. -->
<!-- If we only allow dynamically allocated helpers, we can move all of the create/bind parameters back to the constructor and stipulate that the helpers are dynamically allocated at or after the init methods of the automaton. -->
<!-- The helpers then have a very simple interface: a constructor and a destroy/unbind method. -->
<!-- Suppose that an automaton has allocated some helpers is in its destructor. -->
<!-- Also, suppose that the memory accounting framework does not exists (because it doesn't). -->
<!-- The automaton designer, wishing to not introduce memory leaks, wishes to delete the helpers. -->
<!-- However, the helper might have already been destroyed due to a callback resulting in a double-free. -->
<!-- If we could guarantee that the helpers receive the appropriate destroyed/unbound signals before the destructor for the automaton, then the destructor doesn't need to delete the helpers. -->
<!-- The system can (and does) enforce this. -->
<!-- Otherwise, helpers become too complex and their utility is greatly diminished. -->
<!-- We can group helpers into other objects to make the creation and maintenance of constellations easier. -->
<!-- Initially, this looks difficult as it appears that we have the same problem as before, i.e., an automaton has no way of knowing when a grouping object is safe to delete. -->
<!-- The Observer Pattern to the rescue. -->
<!-- The helpers are observable, thus, the grouping object can observe them and know when they are all destroyed. -->
<!-- If the group object itself is observable, then the automaton can know when the grouping object is defunct. -->
<!-- The pattern can be repeated ad infinitum and resembles a tree structure with the automaton at the root, group objects at the branches, and helpers at the roots. -->
<!-- In the tree, parents observe their children. -->
<!-- * Round-robin scheduler -->
<!-- I would like to make a round-robin scheduler. -->
<!-- Other scheduler's are also possible. -->
<!-- To write: -->
<!--  Explain dispatching_automaton. -->
<!--  UP_INTERNAL macros and underlying wrappers -->
<!--  Why can't you do stuff in constructors? -->
<!--  init () -->
<!--  helpers instead of the Big 4 -->
<!--  scheduling actions -->
<!--  creation caveats = type safety -->
<!--  Why is "this" everywhere? -->
<!-- @node Why I Created ioa++ -->
<!-- @section Why I Created ioa++ -->
<!-- ioa++ is a framework for asynchronous and concurrent computation based on the I/O automata model. -->
<!-- An I/O automaton is a set of state variables and atomic actions that manipulate the state variables. -->
<!-- I/O automata interact by associating an action in one automaton with an action in another. -->
<!-- The semantics of I/O automata are such that a set of interacting automata can analyzed as a single I/O automaton. -->
<!-- Consequently, ioa++ makes it possible to develop reusable modules for asynchronous and concurrent computation and assemble them to create complex systems. -->
<!-- The thread paradigm, a common approach to concurrency, is based on multiple concurrent threads of execution communicating via shared state. -->
<!-- Developing ``thread-safe'' software is difficult because developers must consider all possible interleavings of instructions and use locks to prevent bad program states. -->
<!-- (See @cite{The Problem with Threads} by Edward Lee for more information.) -->
<!-- Furthermore, assembling complex systems from thread-based modules can easily introduce concurrency hazards, e.g., creating a cycle in the graph of resource locks resulting in deadlock. -->
<!-- ioa++ is an alternative to threads. -->
<!-- The absence of shared state and the atomicity of each action obviate the need for locks and other concurrency control mechanisms in ioa++. -->
<!-- and ad hoc event systems. -->
<!-- I created ioa++ so I could build distributed systems by assembling reusable concurrent and asynchronous modules. -->
<!-- Threads are an obvious first choice due to their widespread -->
<!-- I rejected threads because it is difficult to write thread-safe objects and assemble them into a working system. -->
<!-- Developing a thread-safe object is difficult because one must consider all possible interleavings of instructions. -->
<!-- The paper @cite{The Problem with Threads} by Edward Lee is a deeper exploration of this issue. -->
<!-- Assembling thread-safe objects can introduce concurrency hazards by, for example, creating a cycle in the graph of resource locks. -->
<!-- Events are -->
<!-- The difficulties of thread-based development often -->
<!-- Second, events, while matching the semantics of distributed systems, -->
<!-- The difficulties with threads -->
<!-- @node Considerations -->
<!-- @section Implementation Considerations -->
<!-- @subsection Scheduling -->
<!-- The only requirement that the I/O automata model places on the scheduler is fairness. -->
<!-- This is intentional as it reduces the number of assumptions that one needs to make about the environment. -->
<!-- The scheduler is assumed to be omniscient, i.e., it knows all of the actions and can find an action with a true precondition. -->
<!-- While implementing an omniscient scheduler is possible, it hinders the development of an efficient scheduler, i.e., one that avoids selecting actions whose precondition are false. -->
<!-- Consequently, the decision was made that the user is responsible for telling the scheduler which actions to consider. -->
<!-- The scheduler can implement different scheduling policies that influence the order in which actions are selected. -->
<!-- Again, the only requirement is that the scheduler is fair. -->
<!-- The act of telling the scheduler to consider an action for selection and execution is called @dfn{scheduling}. -->
<!-- If a user decides to schedule all actions all the time, then the scheduler degenerates into a brute-force omniscient scheduler. -->
<!-- A better approach has the user test the precondition of all actions and schedules those that are true. -->
<!-- The best approach has the user perform a dependency analysis to determine which actions could possibly enable other actions and then schedule the enabled actions. -->
<!-- Notice that this optimization is not possible unless users schedule the actions. -->
<!-- All of the examples in this document use the middle approach. -->
</body></html>

